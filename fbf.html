<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡¶á‡¶®‡¶≠‡¶Ø‡¶º‡ßá‡¶∏ ‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶ü‡¶∞</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">
  <div class="bg-white shadow-lg rounded-2xl p-6 w-full max-w-2xl">
    <h1 class="text-2xl font-bold text-center mb-4">‡¶á‡¶®‡¶≠‡¶Ø‡¶º‡ßá‡¶∏ ‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶ü‡¶∞</h1>

    <!-- ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶´‡¶ø‡¶≤‡ßç‡¶° -->
    <div class="mb-4">
      <label class="block mb-1 font-semibold">‡¶ï‡ßç‡¶≤‡¶æ‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</label>
      <input id="client-name" type="text" class="w-full border rounded-lg p-2" placeholder="‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
    </div>

    <div class="mb-4">
      <label class="block mb-1 font-semibold">‡¶á‡¶®‡¶≠‡¶Ø‡¶º‡ßá‡¶∏ ‡¶®‡¶Ç</label>
      <input id="invoice-number" type="text" class="w-full border rounded-lg p-2" placeholder="12345">
    </div>

    <div class="mb-4">
      <label class="block mb-1 font-semibold">‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</label>
      <input id="invoice-date" type="date" class="w-full border rounded-lg p-2">
    </div>

    <!-- Paste / Copy ‡¶¨‡¶æ‡¶ü‡¶® -->
    <div class="flex gap-2 mb-4">
      <button onclick="pasteFromClipboard('client-name')" class="bg-blue-500 text-white px-4 py-2 rounded-lg">Paste</button>
      <button onclick="copyToClipboard('client-name')" class="bg-green-500 text-white px-4 py-2 rounded-lg">Copy</button>
    </div>

    <!-- ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶¨‡¶ï‡ßç‡¶∏ -->
    <div id="message-box" class="hidden mt-4 p-4 rounded-lg text-center"></div>

    <!-- ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶á‡¶®‡¶≠‡¶Ø‡¶º‡ßá‡¶∏ ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü -->
    <h2 class="text-xl font-semibold mt-6 mb-2">‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶á‡¶®‡¶≠‡¶Ø‡¶º‡ßá‡¶∏</h2>
    <div id="invoice-list-container" class="space-y-3"></div>
    <p id="empty-list-message" class="text-gray-500 text-center">‡¶ï‡ßã‡¶® ‡¶á‡¶®‡¶≠‡¶Ø‡¶º‡ßá‡¶∏ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶®‡ßá‡¶á‡•§</p>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, addDoc, collection, getDocs, doc, deleteDoc, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    setLogLevel('debug');

    const firebaseConfig = {
      apiKey: "AIzaSyACr4tymiTKrtPltKbAlLulsdG3efoDowQ",
      authDomain: "facebook-c7ea6.firebaseapp.com",
      projectId: "facebook-c7ea6",
      storageBucket: "facebook-c7ea6.firebasestorage.app",
      messagingSenderId: "28858429763",
      appId: "1:28858429763:web:6ddbe43ea94a4bfaf4bff6",
      measurementId: "G-M3VEVHMDH1"
    };

    let app, db, auth, userId;

    document.addEventListener('DOMContentLoaded', () => {
      const messageBox = document.getElementById('message-box');
      const invoiceListContainer = document.getElementById('invoice-list-container');
      const emptyListMessage = document.getElementById('empty-list-message');

      // ‚úÖ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
      const showMessage = (msg, className) => {
        messageBox.textContent = msg;
        messageBox.className = `${className} mt-4 p-4 rounded-lg text-center`;
        messageBox.style.display = 'block';
        setTimeout(() => {
          messageBox.style.display = 'none';
        }, 3000);
      };

      // ‚úÖ Firebase initialize
      const initializeFirebase = async () => {
        try {
          app = initializeApp(firebaseConfig);
          db = getFirestore(app);
          auth = getAuth(app);

          await signInAnonymously(auth);
          userId = auth.currentUser?.uid;
          console.log("Firebase initialized. User ID:", userId);

          loadInvoices();
        } catch (e) {
          console.error("Error initializing Firebase:", e);
          showMessage("Firebase ‡¶ï‡¶®‡¶´‡¶ø‡¶ó‡¶æ‡¶∞‡ßá‡¶∂‡¶® ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø‡¶™‡ßÇ‡¶∞‡ßç‡¶£‡•§", 'bg-red-200 text-red-800');
        }
      };
      initializeFirebase();

      // ‚úÖ Clipboard ‡¶•‡ßá‡¶ï‡ßá Paste
      window.pasteFromClipboard = async (targetId) => {
        const target = document.getElementById(targetId);
        if (!target) return;
        try {
          const text = await navigator.clipboard.readText();
          target.value = text;
          target.focus();
        } catch (err) {
          console.warn("Clipboard API failed, fallback execCommand");
          target.focus();
          document.execCommand('paste');
        }
      };

      // ‚úÖ Clipboard ‡¶è Copy
      window.copyToClipboard = async (targetId) => {
        const target = document.getElementById(targetId);
        if (!target) return;
        try {
          await navigator.clipboard.writeText(target.value);
          showMessage("‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá ‚úÖ", "bg-green-200 text-green-800");
        } catch (err) {
          console.error("Copy failed:", err);
          showMessage("‡¶ï‡¶™‡¶ø ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‚ùå", "bg-red-200 text-red-800");
        }
      };

      // ‚úÖ ‡¶á‡¶®‡¶≠‡¶Ø‡¶º‡ßá‡¶∏ ‡¶≤‡ßã‡¶°
      const loadInvoices = async () => {
        try {
          const snapshot = await getDocs(collection(db, "invoices"));
          const invoices = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
          renderSavedInvoicesList(invoices);
        } catch (err) {
          console.error("Load invoices failed:", err);
        }
      };

      // ‚úÖ ‡¶á‡¶®‡¶≠‡¶Ø‡¶º‡ßá‡¶∏ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
      const renderSavedInvoicesList = (invoices) => {
        invoiceListContainer.innerHTML = '';
        emptyListMessage.style.display = 'none';

        if (invoices.length === 0) {
          emptyListMessage.style.display = 'block';
          return;
        }

        invoices.forEach(invoice => {
          const listItem = document.createElement('div');
          listItem.className = 'p-3 bg-gray-50 rounded-lg shadow flex justify-between items-center';
          listItem.innerHTML = `
            <div>
              <p class="font-bold text-gray-800">${invoice.client?.name || '‡¶Ö‡¶ú‡¶æ‡¶®‡¶æ'}</p>
              <p class="text-sm text-gray-500">‡¶á‡¶®‡¶≠‡¶Ø‡¶º‡ßá‡¶∏ ‡¶®‡¶Ç: ${invoice.invoiceNumber}</p>
              <p class="text-sm text-gray-500">‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ: ${invoice.invoiceDate}</p>
            </div>
            <button class="bg-red-500 text-white px-3 py-1 rounded-lg delete-btn">Delete</button>
          `;
          listItem.querySelector(".delete-btn").addEventListener("click", async () => {
            await deleteDoc(doc(db, "invoices", invoice.id));
            showMessage("‡¶á‡¶®‡¶≠‡¶Ø‡¶º‡ßá‡¶∏ ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá üóëÔ∏è", "bg-red-200 text-red-800");
            loadInvoices();
          });
          invoiceListContainer.appendChild(listItem);
        });
      };
    });
  </script>
</body>
</html>
